{% extends 'base.html' %}

{% block title %}Reklamace – {{ pobocka.nazev }}{% endblock %}

{% block content %}
<section class="reklamace-hero mb-4">
    <p class="text-secondary text-uppercase mb-1" style="font-size: 0.8125rem; letter-spacing: 0.12em; font-weight: 600;">Reklamace</p>
    <h1 class="fw-bold mb-3" style="font-size: clamp(1.5rem, 4vw, 2.25rem); letter-spacing: -0.04em;">{{ pobocka.nazev }}</h1>
    {% if pobocka.adresa or pobocka.firma %}
    <div class="reklamace-return-address card card-apple py-3 px-4 mb-0">
        <div class="d-flex align-items-start gap-2">
            <i class="fas fa-map-marker-alt mt-1" style="color: var(--accent-solid);"></i>
            <div>
                <strong class="d-block mb-1" style="font-size: 0.8125rem; text-transform: uppercase; letter-spacing: 0.06em;">Adresa kde se zboží vrací</strong>
                <span class="text-secondary" style="font-size: 0.9375rem;">{% if pobocka.firma %}{{ pobocka.firma }}{% endif %}{% if pobocka.firma and pobocka.adresa %} · {% endif %}{% if pobocka.adresa %}{{ pobocka.adresa }}{% endif %}{% if not pobocka.adresa and not pobocka.firma %}{{ pobocka.nazev }}{% endif %}</span>
            </div>
        </div>
    </div>
    {% else %}
    <div class="alert alert-info py-2 px-3 mb-0 small">
        <i class="fas fa-info-circle me-2"></i>Admin vyplní adresu a firmu v sekci Pobočky pro právně platný reklamační formulář PDF.
    </div>
    {% endif %}
</section>

<div class="card card-apple mb-4">
    <div class="card-body p-4">
        <h5 class="card-title fw-semibold mb-3">Filtry</h5>
        <form method="GET" class="row g-2 align-items-end">
            <div class="col-md-4">
                <label class="form-label">Hledat</label>
                <input type="text" class="form-control" name="q" placeholder="Zákazník / tel / značka / model" value="{{ filter_q or '' }}">
            </div>
            <div class="col-md-3">
                <label class="form-label">Stav</label>
                <select class="form-select" name="stav">
                    <option value="" {% if not filter_stav %}selected{% endif %}>Vše</option>
                    <option value="Čeká" {% if filter_stav == 'Čeká' %}selected{% endif %}>Čeká</option>
                    <option value="Výměna kus za kus" {% if filter_stav == 'Výměna kus za kus' %}selected{% endif %}>Prošlo – výměna</option>
                    <option value="Posláno do Ústí" {% if filter_stav == 'Posláno do Ústí' %}selected{% endif %}>Posláno do Ústí</option>
                    <option value="Zamítnuto" {% if filter_stav == 'Zamítnuto' %}selected{% endif %}>Zamítnuto</option>
                </select>
            </div>
            <div class="col-md-2">
                <label class="form-label">Od</label>
                <input type="date" class="form-control" name="from" value="{{ filter_from or '' }}">
            </div>
            <div class="col-md-2">
                <label class="form-label">Do</label>
                <input type="date" class="form-control" name="to" value="{{ filter_to or '' }}">
            </div>
            <div class="col-md-1 d-grid">
                <button type="submit" class="btn btn-primary rounded-pill">OK</button>
            </div>
            <div class="col-12 col-md-auto d-flex align-items-end">
                <div class="form-check">
                    <input type="checkbox" class="form-check-input" name="archived" id="filterArchived" value="1" {% if filter_archived %}checked{% endif %} onchange="this.form.submit()">
                    <label class="form-check-label" for="filterArchived">Zobrazit archivované</label>
                </div>
            </div>
        </form>
        <div class="d-flex justify-content-between mt-3">
            <a class="btn btn-outline-secondary btn-sm rounded-pill" href="{{ url_for('reklamace_branch', pobocka_id=pobocka.id) }}">Vyčistit</a>
            <a class="btn btn-outline-primary btn-sm rounded-pill" href="{{ url_for('reklamace_export_csv', pobocka_id=pobocka.id) }}">Export CSV</a>
        </div>
    </div>
</div>

<div class="card card-apple mb-4" id="reklamace-wizard-card">
    <div class="card-body p-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="card-title fw-semibold mb-0">
                <i class="fas fa-clipboard-list me-2" style="color: var(--accent-solid);"></i>Průvodce reklamací
            </h5>
            <div class="reklamace-wizard-steps d-flex gap-2">
                <span class="wizard-step active" data-step="1">1</span>
                <span class="wizard-step" data-step="2">2</span>
                <span class="wizard-step" data-step="3">3</span>
                <span class="wizard-step" data-step="4">4</span>
            </div>
        </div>

        {% if validacni_chyba %}
        <div class="alert alert-danger alert-dismissible fade show mb-3" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>{{ validacni_chyba }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        {% endif %}

        <form method="POST" id="reklamaceWizardForm">
            {{ form.hidden_tag() }}

            <div class="wizard-pane active" data-pane="1">
                <h6 class="wizard-question mb-3">Kdo je zákazník?</h6>
                <p class="text-secondary small mb-3">Zadejte jméno a kontaktní údaje.</p>
                <div class="row g-2">
                    <div class="col-md-6">
                        <label class="form-label">Jméno a příjmení <span class="text-danger">*</span></label>
                        {{ form.zakaznik(class="form-control", placeholder="Jan Novák", required=True) }}
                        {% if form.zakaznik.errors %}<div class="text-danger small mt-1">{% for e in form.zakaznik.errors %}{{ e }}{% endfor %}</div>{% endif %}
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Telefon <span class="text-danger">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text">+420</span>
                            <input type="text" name="telefon" id="telefon" class="form-control" maxlength="9" placeholder="123456789" pattern="\d{9}" title="9 číslic" value="{{ request.form.get('telefon', '') }}" required>
                        </div>
                        {% if form.telefon.errors %}<div class="text-danger small mt-1">{% for e in form.telefon.errors %}{{ e }}{% endfor %}</div>{% endif %}
                    </div>
                </div>
            </div>

            <div class="wizard-pane" data-pane="2">
                <h6 class="wizard-question mb-3">Jaké zboží reklamuje?</h6>
                <p class="text-secondary small mb-3">Značka, model a kdy bylo zboží zakoupeno.</p>
                <div class="row g-2">
                    <div class="col-md-4">
                        <label class="form-label">Značka <span class="text-danger">*</span></label>
                        {{ form.znacka(class="form-control", placeholder="např. Vaporesso", required=True) }}
                        {% if form.znacka.errors %}<div class="text-danger small mt-1">{% for e in form.znacka.errors %}{{ e }}{% endfor %}</div>{% endif %}
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Model <span class="text-danger">*</span></label>
                        {{ form.model(class="form-control", placeholder="např. XROS 3", required=True) }}
                        {% if form.model.errors %}<div class="text-danger small mt-1">{% for e in form.model.errors %}{{ e }}{% endfor %}</div>{% endif %}
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Barva</label>
                        {{ form.barva(class="form-control", placeholder="volitelné") }}
                    </div>
                    <div class="col-md-6 mt-2">
                        <label class="form-label">Kdy bylo zboží zakoupeno? <span class="text-danger">*</span></label>
                        {{ form.datum_zakoupeni(class="form-control", type="date", id="datumZakoupeni", required=True) }}
                        <div id="zarukaInfo" class="small mt-1" style="min-height: 1.5em;"></div>
                    </div>
                    <div class="col-md-6 mt-2">
                        <label class="form-label">Datum přijetí reklamace</label>
                        {{ form.datum_prijmu(class="form-control", type="date") }}
                    </div>
                </div>
            </div>

            <div class="wizard-pane" data-pane="3">
                <h6 class="wizard-question mb-3">Jaká je závada?</h6>
                <p class="text-secondary small mb-3">Popište zjištěnou závadu – bude uvedena na reklamačním formuláři.</p>
                {{ form.popis_zavady(class="form-control", rows="4", placeholder="Např.: Zařízení se po týdnu přestalo nabíjet, dioda nebliká…", required=True) }}
                {% if form.popis_zavady.errors %}<div class="text-danger small mt-1">{% for e in form.popis_zavady.errors %}{{ e }}{% endfor %}</div>{% endif %}
            </div>

            <div class="wizard-pane" data-pane="4">
                <h6 class="wizard-question mb-3">Přehled a dokončení</h6>
                <div class="reklamace-summary mb-4 p-3 rounded" style="background: var(--card-bg);">
                    <div class="summary-row mb-2"><strong>Zákazník:</strong> <span id="sum-zakaznik">—</span></div>
                    <div class="summary-row mb-2"><strong>Zboží:</strong> <span id="sum-zbozi">—</span></div>
                    <div class="summary-row mb-2"><strong>Záruka:</strong> <span id="sum-zaruka">—</span></div>
                    <div class="summary-row mb-2"><strong>Závada:</strong> <span id="sum-zavada">—</span></div>
                </div>
                <div class="row g-2 mb-3">
                    <div class="col-md-4">
                        {{ form.stav.label(class="form-label") }}
                        {{ form.stav(class="form-select") }}
                    </div>
                    <div class="col-md-4" id="slevaProcentWrap" style="display:none;">
                        {{ form.sleva_procent.label(class="form-label") }}
                        {{ form.sleva_procent(class="form-control", type="number", min="0", max="100", step="0.5", placeholder="např. 15") }}
                    </div>
                    <div class="col-md-4">
                        {{ form.cena.label(class="form-label") }}
                        {{ form.cena(class="form-control", type="number", step="0.01", min="0") }}
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                        <div class="form-check">
                            {{ form.zavolano_zakaznikovi(class="form-check-input") }}
                            {{ form.zavolano_zakaznikovi.label(class="form-check-label") }}
                        </div>
                    </div>
                </div>
                <div class="row g-2">
                    <div class="col-md-6">
                        {{ form.reseni.label(class="form-label") }}
                        {{ form.reseni(class="form-control", rows="2", placeholder="Řešení (volitelné)") }}
                    </div>
                    <div class="col-md-6">
                        {{ form.poznamky.label(class="form-label") }}
                        {{ form.poznamky(class="form-control", rows="2", placeholder="Poznámky (volitelné)") }}
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-100 rounded-pill py-2 mt-4 fw-semibold">
                    <i class="fas fa-check-circle me-2"></i>Uložit reklamaci a vytvořit PDF
                </button>
            </div>

            <div class="d-flex justify-content-between mt-4">
                <button type="button" class="btn btn-outline-secondary rounded-pill wizard-nav" id="wizardPrev" style="display:none;">← Zpět</button>
                <button type="button" class="btn btn-primary rounded-pill wizard-nav" id="wizardNext">Další →</button>
            </div>
        </form>
    </div>
</div>

<style>
.reklamace-table-section .table-reklamace { background: var(--surface) !important; }
.reklamace-table-section .table-reklamace tbody td,
.reklamace-table-section .table-reklamace tbody th { color: var(--text) !important; background: var(--surface) !important; }
[data-theme="dark"] .reklamace-table-section .table-reklamace tbody td,
[data-theme="dark"] .reklamace-table-section .table-reklamace tbody th { color: #f8fafc !important; background: #16161a !important; }
[data-theme="dark"] .reklamace-table-section .table-reklamace thead th { color: #f8fafc !important; background: #25252b !important; }
.reklamace-wizard-steps .wizard-step {
    width: 32px; height: 32px; border-radius: 50%;
    display: inline-flex; align-items: center; justify-content: center;
    font-size: 0.875rem; font-weight: 600;
    background: var(--border); color: var(--text-secondary);
    transition: all 0.25s;
}
.reklamace-wizard-steps .wizard-step.active { background: var(--accent-solid); color: #fff; }
.reklamace-wizard-steps .wizard-step.done { background: rgba(34,197,94,0.3); color: #16a34a; }
.wizard-pane { display: none; min-height: 120px; }
.wizard-pane.active { display: block; animation: wizardFade 0.3s ease; }
@keyframes wizardFade { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }
.wizard-question { font-size: 1.125rem; font-weight: 600; letter-spacing: -0.02em; }
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    var panes = document.querySelectorAll('.wizard-pane');
    var steps = document.querySelectorAll('.wizard-step');
    var prevBtn = document.getElementById('wizardPrev');
    var nextBtn = document.getElementById('wizardNext');
    var currentStep = 1;

    function goTo(step) {
        currentStep = step;
        panes.forEach(function(p) {
            p.classList.remove('active');
            if (parseInt(p.dataset.pane) === step) p.classList.add('active');
        });
        steps.forEach(function(s) {
            s.classList.remove('active', 'done');
            var n = parseInt(s.dataset.step);
            if (n === step) s.classList.add('active');
            else if (n < step) s.classList.add('done');
        });
        prevBtn.style.display = step === 1 ? 'none' : '';
        nextBtn.style.display = step === 4 ? 'none' : '';
        if (step === 4) updateSummary();
        if (step === 2) updateZarukaInfo();
    }

    function formatDate(str) {
        if (!str || str.length !== 10) return str;
        var p = str.split('-');
        return p[2] + '.' + p[1] + '.' + p[0];
    }
    function updateSummary() {
        var form = document.getElementById('reklamaceWizardForm');
        var z = form.querySelector('input[name="zakaznik"]');
        var t = form.querySelector('input[name="telefon"]');
        var zn = form.querySelector('input[name="znacka"]');
        var m = form.querySelector('input[name="model"]');
        var b = form.querySelector('input[name="barva"]');
        var dz = form.querySelector('input[name="datum_zakoupeni"]');
        var pz = form.querySelector('textarea[name="popis_zavady"]');
        var zakaznik = (z && z.value.trim()) ? z.value.trim() : '—';
        var tel = (t && t.value.trim()) ? '+420 ' + t.value.trim() : '';
        var zbozi = [zn&&zn.value, m&&m.value, b&&b.value].filter(Boolean).join(' ') || '—';
        if (dz && dz.value) zbozi += ' (zakoupeno ' + formatDate(dz.value) + ')';
        var zavada = (pz && pz.value.trim()) ? (pz.value.length > 80 ? pz.value.substring(0,80)+'…' : pz.value) : '—';
        var zarukaText = '—';
        if (dz && dz.value) {
            var konec = zarukaVyprsi(dz.value);
            var platna = jeZarukaPlatna(dz.value);
            if (platna) zarukaText = 'Platí do ' + formatDateCs(konec);
            else zarukaText = 'Vypršela – nelze přijmout';
        }
        document.getElementById('sum-zakaznik').textContent = zakaznik + (tel ? ' · ' + tel : '');
        document.getElementById('sum-zbozi').textContent = zbozi;
        document.getElementById('sum-zaruka').textContent = zarukaText;
        document.getElementById('sum-zavada').textContent = zavada;
    }

    function zarukaVyprsi(datumZakoupeni) {
        if (!datumZakoupeni || datumZakoupeni.length !== 10) return null;
        var d = new Date(datumZakoupeni);
        var konec = new Date(d);
        konec.setFullYear(konec.getFullYear() + 2);
        return konec;
    }
    function jeZarukaPlatna(datumZakoupeni) {
        var konec = zarukaVyprsi(datumZakoupeni);
        if (!konec) return null;
        return new Date() <= konec;
    }
    function formatDateCs(d) {
        return d.getDate() + '.' + (d.getMonth()+1) + '.' + d.getFullYear();
    }
    function updateZarukaInfo() {
        var dz = (document.getElementById('datumZakoupeni') || {}).value || '';
        var el = document.getElementById('zarukaInfo');
        if (!el) return;
        if (!dz) { el.innerHTML = '<span class="text-secondary">Záruka 2 roky – zadejte datum zakoupení</span>'; return; }
        var konec = zarukaVyprsi(dz);
        var platna = jeZarukaPlatna(dz);
        if (platna === null) { el.innerHTML = ''; return; }
        if (platna) {
            el.innerHTML = '<span class="text-success"><i class="fas fa-check-circle me-1"></i>Záruka platí do ' + formatDateCs(konec) + '</span>';
        } else {
            el.innerHTML = '<span class="text-danger"><i class="fas fa-exclamation-triangle me-1"></i>Záruka vypršela – reklamace starší než 2 roky</span>';
        }
    }

    function validujKrok(step) {
        var form = document.getElementById('reklamaceWizardForm');
        var z = (form.querySelector('input[name="zakaznik"]') || {}).value || '';
        var t = (form.querySelector('input[name="telefon"]') || {}).value || '';
        var zn = (form.querySelector('input[name="znacka"]') || {}).value || '';
        var m = (form.querySelector('input[name="model"]') || {}).value || '';
        var dp = (form.querySelector('input[name="datum_prijmu"]') || {}).value || '';
        var dz = (form.querySelector('input[name="datum_zakoupeni"]') || document.getElementById('datumZakoupeni') || {}).value || '';
        var pz = (form.querySelector('textarea[name="popis_zavady"]') || {}).value || '';
        if (step === 1) {
            if (!z.trim()) { alert('Zadejte jméno zákazníka.'); return false; }
            if (!/^\d{9}$/.test((t || '').replace(/\s/g, ''))) { alert('Zadejte platné telefonní číslo (9 číslic).'); return false; }
        } else if (step === 2) {
            if (!zn.trim()) { alert('Zadejte značku zboží.'); return false; }
            if (!m.trim()) { alert('Zadejte model zboží.'); return false; }
            if (!dp.trim()) { alert('Zadejte datum přijetí reklamace.'); return false; }
            if (!dz.trim()) { alert('Zadejte datum zakoupení – potřebné pro kontrolu záruky (2 roky).'); return false; }
            if (!jeZarukaPlatna(dz)) { alert('Záruka vypršela. Zboží je starší než 2 roky – nelze přijmout reklamaci.'); return false; }
        } else if (step === 3) {
            if (!pz.trim()) { alert('Zadejte popis závady.'); return false; }
        }
        return true;
    }

    nextBtn.addEventListener('click', function() {
        if (currentStep >= 4) return;
        if (!validujKrok(currentStep)) return;
        goTo(currentStep + 1);
    });
    prevBtn.addEventListener('click', function() { if (currentStep > 1) goTo(currentStep - 1); });
    steps.forEach(function(s) {
        s.addEventListener('click', function() {
            var targetStep = parseInt(this.dataset.step);
            if (targetStep <= currentStep) { goTo(targetStep); return; }
            for (var k = 1; k < targetStep; k++) {
                if (!validujKrok(k)) { alert('Nejprve vyplňte povinná pole v předchozích krocích.'); return; }
            }
            goTo(targetStep);
        });
    });

    document.getElementById('reklamaceWizardForm').addEventListener('submit', function(e) {
        var form = this;
        var zakaznik = (form.querySelector('input[name="zakaznik"]') || {}).value || '';
        var telefon = (form.querySelector('input[name="telefon"]') || {}).value || '';
        var znacka = (form.querySelector('input[name="znacka"]') || {}).value || '';
        var model = (form.querySelector('input[name="model"]') || {}).value || '';
        var dz = (form.querySelector('input[name="datum_zakoupeni"]') || document.getElementById('datumZakoupeni') || {}).value || '';
        var popis = (form.querySelector('textarea[name="popis_zavady"]') || {}).value || '';
        if (!zakaznik.trim()) { e.preventDefault(); goTo(1); alert('Zadejte jméno zákazníka.'); return false; }
        if (!/^\d{9}$/.test((telefon || '').replace(/\s/g, ''))) { e.preventDefault(); goTo(1); alert('Zadejte platné telefonní číslo (9 číslic).'); return false; }
        if (!znacka.trim()) { e.preventDefault(); goTo(2); alert('Zadejte značku zboží.'); return false; }
        if (!model.trim()) { e.preventDefault(); goTo(2); alert('Zadejte model zboží.'); return false; }
        if (!dz.trim()) { e.preventDefault(); goTo(2); alert('Zadejte datum zakoupení – potřebné pro kontrolu záruky (2 roky).'); return false; }
        if (!jeZarukaPlatna(dz)) { e.preventDefault(); goTo(2); alert('Záruka vypršela. Zboží je starší než 2 roky – nelze přijmout reklamaci.'); return false; }
        if (!popis.trim()) { e.preventDefault(); goTo(3); alert('Zadejte popis závady.'); return false; }
    });
    document.getElementById('reklamaceWizardForm').addEventListener('input', function() { updateSummary(); updateZarukaInfo(); });
    document.getElementById('reklamaceWizardForm').addEventListener('change', function() {
        updateSummary();
        updateZarukaInfo();
        var stavSel = document.querySelector('#reklamaceWizardForm select[name="stav"]');
        var wrap = document.getElementById('slevaProcentWrap');
        if (stavSel && wrap) wrap.style.display = (stavSel.value === 'Zamítnuto') ? 'block' : 'none';
    });
    var stavSel = document.querySelector('#reklamaceWizardForm select[name="stav"]');
    if (stavSel && stavSel.value === 'Zamítnuto') document.getElementById('slevaProcentWrap').style.display = 'block';
});
</script>

<section class="mb-4 reklamace-table-section">
    <h3 class="fw-semibold mb-3" style="font-size: 1.25rem; letter-spacing: -0.02em;">Reklamace na pobočce ({{ reklamace|length }})</h3>
    <div class="card card-apple overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover table-bordered mb-0 table-reklamace">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Zákazník</th>
                        <th>Značka / model</th>
                        <th>Přijetí</th>
                        <th>Zakoupeno</th>
                        <th>Stav</th>
                        <th class="text-center" title="Bylo zákazníkovi zavoláno?">Zavoláno</th>
                        <th>Cena</th>
                        <th>Akce</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in reklamace %}
                    <tr>
                        <td><strong>#{{ r.id }}</strong></td>
                        <td>{{ r.zakaznik }}{% if r.telefon %}<br><small class="text-secondary">{{ r.telefon }}</small>{% endif %}</td>
                        <td><strong>{{ r.znacka }}</strong>{% if r.model %} / {{ r.model }}{% endif %}{% if r.barva %} <span class="text-secondary">({{ r.barva }})</span>{% endif %}</td>
                        <td>{{ r.datum_prijmu.strftime('%d.%m.%Y') }}</td>
                        <td>{% if r.datum_zakoupeni %}{{ r.datum_zakoupeni.strftime('%d.%m.%Y') }}{% else %}<span class="text-muted">—</span>{% endif %}</td>
                        <td>
                            {% if r.stav == 'Čeká' %}
                                <span class="badge bg-secondary rounded-pill">Čeká</span>
                            {% elif r.stav == 'Výměna kus za kus' %}
                                <span class="badge bg-success rounded-pill">Prošlo – výměna</span>
                            {% elif r.stav == 'Posláno do Ústí' %}
                                <span class="badge bg-primary rounded-pill">Posláno do Ústí</span>
                            {% elif r.stav == 'Zamítnuto' %}
                                <span class="badge bg-danger rounded-pill">Zamítnuto{% if r.sleva_procent %} (sleva {{ r.sleva_procent|int }}%){% endif %}</span>
                            {% else %}
                                <span class="badge bg-secondary rounded-pill">{{ r.stav }}</span>
                            {% endif %}
                        </td>
                        <td class="text-center">{% if r.zavolano_zakaznikovi %}<span class="badge bg-success rounded-pill" title="Zákazníkovi bylo zavoláno"><i class="fas fa-phone-alt me-1"></i>Ano</span>{% else %}<span class="badge bg-secondary rounded-pill text-muted" title="Zákazníkovi nebylo zavoláno">Ne</span>{% endif %}</td>
                        <td>{% if r.cena %}<strong>{{ "{:,.0f}".format(r.cena) }} Kč</strong>{% else %}<span class="text-muted">—</span>{% endif %}</td>
                        <td>
                            <div class="d-flex flex-wrap gap-1">
                                {% if r.stav == 'Čeká' %}
                                <form method="POST" action="{{ url_for('reklamace_change_status', reklamace_id=r.id) }}" class="d-inline">
                                    <input type="hidden" name="action" value="vymena">
                                    <button type="submit" class="btn btn-success btn-sm rounded-pill" title="Reklamace prošla, zákazník dostal výměnu">Prošlo – výměna</button>
                                </form>
                                <form method="POST" action="{{ url_for('reklamace_change_status', reklamace_id=r.id) }}" class="d-inline">
                                    <input type="hidden" name="action" value="poslano_usti">
                                    <button type="submit" class="btn btn-primary btn-sm rounded-pill" title="Odesláno k vyřízení">Posláno do Ústí</button>
                                </form>
                                {% endif %}
                                {% if r.stav != 'Zamítnuto' and r.stav != 'Výměna kus za kus' and r.stav != 'Posláno do Ústí' %}
                                <form method="POST" action="{{ url_for('reklamace_change_status', reklamace_id=r.id) }}" class="d-inline">
                                    <input type="hidden" name="action" value="zamitnuto">
                                    <button type="submit" class="btn btn-danger btn-sm rounded-pill" title="Reklamace nebyla uznána">Zamítnout</button>
                                </form>
                                {% endif %}
                                {% if r.stav in ['Výměna kus za kus', 'Zamítnuto'] and not r.archived %}
                                <form method="POST" action="{{ url_for('reklamace_archive', reklamace_id=r.id) }}" class="d-inline">
                                    <button type="submit" class="btn btn-outline-warning btn-sm rounded-pill" title="Přesunout do archivu – prohlížení v Admin">Archivovat</button>
                                </form>
                                {% endif %}
                                <a class="btn btn-outline-primary btn-sm rounded-pill" href="{{ url_for('reklamace_edit', reklamace_id=r.id) }}">Upravit</a>
                                <a class="btn btn-outline-secondary btn-sm rounded-pill" href="{{ url_for('reklamace_print', reklamace_id=r.id) }}" target="_blank">PDF</a>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<a href="{{ url_for('reklamace_index') }}" class="btn btn-outline-secondary rounded-pill">
    <i class="fas fa-arrow-left me-2"></i>Zpět na přehled reklamací
</a>
{% endblock %}
