{% extends 'base.html' %}

{% block title %}Admin - P≈ôehled{% endblock %}

{% block content %}
<style>
.admin-header { flex-wrap: wrap; gap: 0.75rem; }
.admin-header .admin-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; align-items: center; }
@media (max-width: 768px) {
    .admin-header { flex-direction: column; align-items: stretch; }
    .admin-header .admin-actions { justify-content: stretch; }
    .admin-header .admin-actions .btn { flex: 1; min-width: 0; }
}
.admin-stat-card { min-height: 0; }
.admin-stat-card .card-body { padding: 0.75rem; }
@media (max-width: 576px) {
    .admin-stat-card .card-body { padding: 0.6rem; font-size: 0.9rem; }
}
.reklamace-stats-row { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 0.5rem; padding-bottom: 0.5rem; -webkit-overflow-scrolling: touch; }
.reklamace-stats-row .col { flex: 0 0 auto; min-width: 90px; }
@media (min-width: 992px) {
    .reklamace-stats-row { flex-wrap: wrap; overflow: visible; }
    .reklamace-stats-row .col { flex: 1; min-width: 0; }
}
.table-mobile-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; }
.admin-section .card-header { cursor: pointer; }
.admin-section .card-header .btn-link { text-decoration: none; color: inherit; font-weight: 600; }
.users-mobile-cards { display: none; }
@media (max-width: 768px) {
    .users-table-wrap { display: none; }
    .users-mobile-cards { display: block; }
}
.user-mobile-card { border-left: 4px solid var(--table-header-bg); }
</style>

<div class="d-flex admin-header justify-content-between align-items-center mb-3 mb-md-4">
    <div>
        <h1 class="mb-0 fw-semibold" style="font-size: 1.5rem; letter-spacing: -0.03em;">Admin panel</h1>
        <p class="text-secondary small mb-0 mt-1">Stisknƒõte <kbd class="kbd-hint">‚åòK</kbd> pro rychl√© vyhled√°v√°n√≠</p>
    </div>
    <div class="admin-actions">
        <span class="badge bg-secondary align-middle">
            {{ current_user.jmeno or current_user.username }}
            {% if current_user.pobocka_id and current_user.pobocka %}({{ current_user.pobocka.nazev }}){% endif %}
            {% if is_admin %}<span class="badge bg-dark ms-1">Admin</span>{% endif %}
        </span>
        {% if is_admin %}
        <a href="{{ url_for('admin_statistiky') }}" class="btn btn-outline-secondary btn-sm">Statistiky</a>
        <a href="{{ url_for('admin_reklamace_archiv') }}" class="btn btn-outline-secondary btn-sm">Archiv reklamac√≠</a>
        <a href="{{ url_for('admin_export_excel') }}" class="btn btn-outline-secondary btn-sm">Excel</a>
        <a href="{{ url_for('admin_export_all') }}" class="btn btn-outline-secondary btn-sm">CSV</a>
        {% endif %}
        <a href="{{ url_for('index') }}" class="btn btn-outline-secondary btn-sm">Index</a>
    </div>
</div>

{% if is_admin %}
<!-- Posledn√≠ aktivita (n√°hled) -->
{% if akce and akce|length > 0 %}
<div class="card mb-3 shadow-sm admin-section">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapseLastActivity" aria-expanded="false">
        <span class="fw-bold">Posledn√≠ aktivita</span>
        <span class="badge bg-light text-dark ms-2">{{ akce|length }}</span>
    </div>
    <div class="collapse show" id="collapseLastActivity">
        <div class="card-body py-2">
            <ul class="list-unstyled mb-0 small">
                {% for a in akce[:5] %}
                <li class="border-bottom border-light py-1">
                    <span class="text-muted">{{ a.datum.strftime('%d.%m. %H:%M') }}</span>
                    {% if a.typ == 'Reklamace' %}<span class="badge bg-secondary">R</span>{% else %}<span class="badge bg-secondary">O</span>{% endif %}
                    <strong>{{ a.uzivatel }}</strong> ‚Äì {{ a.akce }}
                </li>
                {% endfor %}
            </ul>
            <p class="mb-0 mt-1 small text-muted">V√≠ce v sekci Historie n√≠≈æe.</p>
        </div>
    </div>
</div>
{% endif %}

<!-- Rychl√© akce -->
<div class="card mb-3 shadow-sm admin-section">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapseQuickActions" aria-expanded="true">
        <span class="fw-bold">Rychl√© akce</span>
    </div>
    <div class="collapse show" id="collapseQuickActions">
        <div class="card-body">
            <div class="row g-2">
                <div class="col-6 col-md-3"><a href="{{ url_for('index') }}" class="btn btn-primary w-100">Nov√Ω odbƒõr</a></div>
                <div class="col-6 col-md-3"><a href="{{ url_for('reklamace_index') }}" class="btn btn-outline-secondary w-100">Reklamace</a></div>
                <div class="col-6 col-md-3"><a href="{{ url_for('admin_reklamace_archiv') }}" class="btn btn-outline-secondary w-100">Archiv reklamac√≠</a></div>
                <div class="col-6 col-md-3"><a href="{{ url_for('admin_statistiky') }}" class="btn btn-outline-secondary w-100">Statistiky</a></div>
                <div class="col-6 col-md-3"><a href="{{ url_for('admin_export_excel') }}" class="btn btn-outline-secondary w-100">Export Excel</a></div>
            </div>
        </div>
    </div>
</div>

<!-- Celkov√© statistiky -->
<div class="row g-2 g-md-3 mb-3 mb-md-4">
    <div class="col-6 col-md-3">
        <div class="card card-apple admin-stat-card h-100">
            <div class="card-body text-center">
                <div class="text-muted mb-0 small">Odbƒõry</div>
                <h5 class="mb-0">{{ statistiky.celkem_odberu or 0 }}</h5>
                <small class="text-muted">Odbƒõr≈Ø</small>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card card-apple admin-stat-card h-100">
            <div class="card-body text-center">
                <div class="text-muted mb-0 small">Reklamace</div>
                <h5 class="mb-0">{{ statistiky.celkem_reklamaci or 0 }}</h5>
                <small class="text-muted">Reklamac√≠</small>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card shadow-sm border-info admin-stat-card h-100">
            <div class="card-body text-center">
                <div class="text-muted mb-0 small">Poboƒçky</div>
                <h5 class="mb-0">{{ statistiky.celkem_pobocek or 0 }}</h5>
                <small class="text-muted">Poboƒçek</small>
            </div>
        </div>
    </div>
    <div class="col-6 col-md-3">
        <div class="card shadow-sm border-success admin-stat-card h-100">
            <div class="card-body text-center">
                <div class="text-muted mb-0 small">U≈æivatel√©</div>
                <h5 class="mb-0">{{ statistiky.celkem_uzivatelu or 0 }}</h5>
                <small class="text-muted">U≈æivatel≈Ø</small>
            </div>
        </div>
    </div>
</div>

<!-- Statistiky reklamac√≠ (horizont√°ln√≠ scroll na mobilu) -->
<div class="row reklamace-stats-row g-2 mb-3">
    <div class="col"><div class="card shadow-sm text-center"><div class="card-body py-2"><strong>{{ statistiky.ceka_reklamace or 0 }}</strong><br><small>ƒåek√°</small></div></div></div>
    <div class="col"><div class="card shadow-sm text-center"><div class="card-body py-2"><strong>{{ statistiky.vymena_reklamace or 0 }}</strong><br><small>Pro≈°lo ‚Äì v√Ωmƒõna</small></div></div></div>
    <div class="col"><div class="card shadow-sm border-info text-center"><div class="card-body py-2"><strong>{{ statistiky.poslano_reklamace or 0 }}</strong><br><small>Posl√°no do √öst√≠</small></div></div></div>
    <div class="col"><div class="card shadow-sm text-center"><div class="card-body py-2"><strong>{{ statistiky.sleva_reklamace or 0 }}</strong><br><small title="Zam√≠tnuto, ale udƒõlena sleva v %">Sleva</small></div></div></div>
    <div class="col"><div class="card shadow-sm text-center"><div class="card-body py-2"><strong>{{ statistiky.zamitnuto_reklamace or 0 }}</strong><br><small>Zam√≠tnuto</small></div></div></div>
    <div class="col"><div class="card shadow-sm border-success text-center"><div class="card-body py-2"><strong>{{ statistiky.vyrizene_reklamace or 0 }}</strong><br><small>Vy≈ô√≠zen√©</small></div></div></div>
    <div class="col"><div class="card shadow-sm text-center"><div class="card-body py-2"><strong>{{ ((statistiky.vyrizene_reklamace or 0) / (statistiky.celkem_reklamaci or 1) * 100)|round(1) }}%</strong><br><small>√öspƒõ≈°nost</small></div></div></div>
</div>

<!-- P≈ôidat poboƒçku + P≈ôidat u≈æivatele (collapsible) -->
<div class="accordion mb-3" id="accordionAdminForms">
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapsePobocka">P≈ôidat poboƒçku</button>
        </h2>
        <div id="collapsePobocka" class="accordion-collapse collapse" data-bs-parent="#accordionAdminForms">
            <div class="accordion-body">
                <form method="POST">
                    {{ pobocka_form.hidden_tag() }}
                    <div class="mb-3">
                        {{ pobocka_form.nazev.label(class="form-label fw-bold") }}
                        {{ pobocka_form.nazev(class="form-control", placeholder="Nap≈ô. Praha, Brno...") }}
                        {% if pobocka_form.nazev.errors %}<div class="text-danger small">{% for e in pobocka_form.nazev.errors %}{{ e }}{% endfor %}</div>{% endif %}
                    </div>
                    <button type="submit" class="btn btn-primary w-100 w-md-auto">P≈ôidat poboƒçku</button>
                </form>
            </div>
        </div>
    </div>
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUser">üë§ P≈ôidat u≈æivatele</button>
        </h2>
        <div id="collapseUser" class="accordion-collapse collapse" data-bs-parent="#accordionAdminForms">
            <div class="accordion-body">
                <form method="POST" id="addUserFormInline">
                    {{ user_form.hidden_tag() }}
                    <div class="mb-3">
                        {{ user_form.jmeno.label(class="form-label fw-bold") }}
                        {{ user_form.jmeno(class="form-control", placeholder="Jm√©no a p≈ô√≠jmen√≠") }}
                        {% if user_form.jmeno.errors %}<div class="text-danger small">{% for e in user_form.jmeno.errors %}{{ e }}{% endfor %}</div>{% endif %}
                    </div>
                    <div class="row g-2">
                        <div class="col-md-6">
                            {{ user_form.pin.label(class="form-label fw-bold") }}
                            {{ user_form.pin(class="form-control", placeholder="4-10 ƒç√≠slic") }}
                            {% if user_form.pin.errors %}<div class="text-danger small">{% for e in user_form.pin.errors %}{{ e }}{% endfor %}</div>{% endif %}
                        </div>
                        <div class="col-md-6">
                            {{ user_form.role.label(class="form-label fw-bold") }}
                            {{ user_form.role(class="form-select") }}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-bold">Poboƒçky</label>
                        <div class="border rounded p-2" style="max-height: 150px; overflow-y: auto;">
                            {% for pobocka in all_pobocky %}
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" name="pobocky" value="{{ pobocka.id }}" id="add_pobocka_{{ pobocka.id }}">
                                <label class="form-check-label" for="add_pobocka_{{ pobocka.id }}">{{ pobocka.nazev }}</label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="mb-3">
                        {{ user_form.password.label(class="form-label fw-bold") }}
                        {{ user_form.password(class="form-control", placeholder="Voliteln√©, min. 6 znak≈Ø") }}
                    </div>
                    <button type="submit" class="btn btn-warning w-100 w-md-auto">P≈ôidat u≈æivatele</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Seznam u≈æivatel≈Ø -->
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapseUsers" aria-expanded="true">
        <span class="fw-bold">Seznam u≈æivatel≈Ø</span>
    </div>
    <div class="collapse show" id="collapseUsers">
        <div class="card-body p-0">
            {% if users %}
            <div class="users-mobile-cards p-2">
                {% for u in users %}
                <div class="card user-mobile-card mb-2">
                    <div class="card-body py-2">
                        <strong>{{ u.jmeno or u.username }}</strong>
                        <span class="badge bg-secondary ms-1">{{ u.pin or '-' }}</span>
                        {% if u.role == 'admin' %}<span class="badge bg-dark">Admin</span>{% endif %}
                        <div class="mt-1">
                            <a href="{{ url_for('edit_user', id=u.id) }}" class="btn btn-sm btn-warning">Edit</a>
                            {% if u.id != current_user.id %}
                            <form action="{{ url_for('delete_user', id=u.id) }}" method="POST" onsubmit="return confirm('Smazat tohoto u≈æivatele?');" class="d-inline">
                                <button type="submit" class="btn btn-sm btn-danger">Smazat</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div class="table-mobile-wrap users-table-wrap">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-primary"><tr><th>Jm√©no</th><th>PIN</th><th>Poboƒçky</th><th>Role</th><th>Akce</th></tr></thead>
                    <tbody>
                    {% for u in users %}
                    <tr>
                        <td><strong>{{ u.jmeno or u.username }}</strong></td>
                        <td><code class="bg-light px-2 py-1 rounded">{{ u.pin or '-' }}</code></td>
                        <td>{% if u.role == 'admin' %}<span class="badge bg-info">V≈°echny</span>{% elif u.pobocky %}{% for pob in u.pobocky %}<span class="badge bg-primary me-1">{{ pob.nazev }}</span>{% endfor %}{% elif u.pobocka %}<span class="badge bg-primary">{{ u.pobocka.nazev }}</span>{% else %}<span class="text-muted">‚Äî</span>{% endif %}</td>
                        <td>{% if u.role == 'admin' %}<span class="badge bg-warning text-dark">Admin</span>{% else %}<span class="badge bg-secondary">U≈æivatel</span>{% endif %}</td>
                        <td>
                            <a href="{{ url_for('edit_user', id=u.id) }}" class="btn btn-sm btn-warning me-1">Edit</a>
                            {% if u.id != current_user.id %}
                            <form action="{{ url_for('delete_user', id=u.id) }}" method="POST" onsubmit="return confirm('Smazat?');" class="d-inline">
                                <button type="submit" class="btn btn-danger btn-sm">Smazat</button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center py-3 mb-0">Zat√≠m nejsou ≈æ√°dn√≠ u≈æivatel√©.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Seznam poboƒçek -->
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapsePobocky" aria-expanded="true">
        <span class="fw-bold">Seznam poboƒçek</span>
    </div>
    <div class="collapse show" id="collapsePobocky">
        <div class="card-body p-0">
            {% if pobocky %}
            <div class="table-mobile-wrap">
                <table class="table table-hover table-striped mb-0">
                    <thead class="table-primary"><tr><th>N√°zev</th><th class="text-center">U≈æivatel√©</th><th>Akce</th></tr></thead>
                    <tbody>
                    {% for pob in pobocky %}
                    <tr>
                        <td><strong>{{ pob.nazev }}</strong></td>
                        <td class="text-center"><span class="badge bg-info">{{ pob.users|length if pob.users else 0 }}</span></td>
                        <td>
                            <a href="{{ url_for('edit_pobocka', id=pob.id) }}" class="btn btn-sm btn-warning me-1">Edit</a>
                            <form action="{{ url_for('delete_pobocka', id=pob.id) }}" method="POST" onsubmit="return confirm('Smazat poboƒçku {{ pob.nazev }}?');" class="d-inline">
                                <button type="submit" class="btn btn-danger btn-sm">Smazat</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center py-3 mb-0">Zat√≠m nejsou ≈æ√°dn√© poboƒçky.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Filtr roku -->
<div class="card card-apple mb-3">
    <div class="card-header py-2 d-flex justify-content-between align-items-center" style="background: var(--table-header-bg); color: var(--table-header-text);">
        <span class="fw-bold">Rok</span>
        <form method="GET" class="d-inline">
            <select name="rok" class="form-select form-select-sm d-inline-block" style="width: auto;" onchange="this.form.submit()">
                {% set current_year = 2026 %}
                {% for rok in range(current_year, current_year - 6, -1) %}
                <option value="{{ rok }}" {% if rok == selected_year %}selected{% endif %}>{{ rok }}</option>
                {% endfor %}
            </select>
        </form>
    </div>
</div>

<!-- P≈ôehled poboƒçek ‚Äì Odbƒõry -->
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapsePrehled" aria-expanded="true">
        <span class="fw-bold">P≈ôehled poboƒçek ‚Äì Odbƒõry</span>
    </div>
    <div class="collapse show" id="collapsePrehled">
        <div class="card-body p-0">
            {% if prehled %}
            <div class="table-mobile-wrap">
                <table class="table table-hover table-striped mb-0 small">
                    <thead class="table-success">
                        <tr><th>Poboƒçka</th><th class="text-center">Aktivn√≠</th><th class="text-center">Zelen√©</th><th class="text-center">ƒåerven√©</th><th class="text-center">Vyd√°no</th><th class="text-center">Nevyzved.</th><th class="text-center">Smaz√°no</th><th class="text-end">ƒå√°stka (Kƒç)</th></tr>
                    </thead>
                    <tbody>
                    {% for polozka in prehled %}
                    <tr>
                        <td><strong>{{ polozka.nazev }}</strong></td>
                        <td class="text-center"><span class="badge bg-primary rounded-pill">{{ polozka.aktivni }}</span></td>
                        <td class="text-center"><span class="badge bg-success rounded-pill">{{ polozka.zelene }}</span></td>
                        <td class="text-center"><span class="badge bg-danger rounded-pill">{{ polozka.cervene }}</span></td>
                        <td class="text-center"><span class="badge bg-info text-dark rounded-pill">{{ polozka.vydano }}</span></td>
                        <td class="text-center"><span class="badge bg-warning text-dark rounded-pill">{{ polozka.nevyzvednuto }}</span></td>
                        <td class="text-center"><span class="badge bg-secondary rounded-pill">{{ polozka.smazano }}</span></td>
                        <td class="text-end"><strong>{{ "{:,.0f}".format(polozka.castka_vydano) }} Kƒç</strong></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center py-3 mb-0">Zat√≠m ≈æ√°dn√© poboƒçky.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Reklamace ‚Äì p≈ôehled podle poboƒçek -->
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapseReklamace" aria-expanded="true">
        <span class="fw-bold">Reklamace podle poboƒçek</span>
    </div>
    <div class="collapse show" id="collapseReklamace">
        <div class="card-body p-0">
            {% if reklamace_prehled %}
            <div class="table-mobile-wrap">
                <table class="table table-hover table-striped mb-0 small">
                    <thead class="table-warning">
                        <tr><th>Poboƒçka</th><th class="text-center">Celkem</th><th class="text-center">ƒåek√°</th><th class="text-center">Pro≈°lo</th><th class="text-center">Posl√°no</th><th class="text-center">Sleva</th><th class="text-center">Zam√≠tnuto</th><th class="text-center">Vy≈ô√≠zen√©</th><th class="text-center">Akce</th></tr>
                    </thead>
                    <tbody>
                    {% for r in reklamace_prehled %}
                    <tr>
                        <td><strong>{{ r.nazev }}</strong></td>
                        <td class="text-center"><span class="badge bg-secondary rounded-pill">{{ r.celkem }}</span></td>
                        <td class="text-center"><span class="badge bg-primary rounded-pill">{{ r.ceka }}</span></td>
                        <td class="text-center"><span class="badge bg-success rounded-pill">{{ r.vymena }}</span></td>
                        <td class="text-center"><span class="badge bg-info text-dark rounded-pill">{{ r.poslano }}</span></td>
                        <td class="text-center"><span class="badge rounded-pill" style="background: rgba(168,85,247,0.25); color: #a855f7;">{{ r.sleva }}</span></td>
                        <td class="text-center"><span class="badge bg-secondary rounded-pill">{{ r.zamitnuto }}</span></td>
                        <td class="text-center"><span class="badge bg-success rounded-pill">{{ r.vyrizene }}</span></td>
                        <td class="text-center"><a href="{{ url_for('reklamace_branch', pobocka_id=r.pobocka_id) }}" class="btn btn-sm btn-outline-primary">Otev≈ô√≠t</a></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center py-3 mb-0">Zat√≠m ≈æ√°dn√© reklamace.</p>
            {% endif %}
        </div>
    </div>
</div>

<!-- Historie akc√≠ -->
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);" data-bs-toggle="collapse" data-bs-target="#collapseHistorie" aria-expanded="false">
        <span class="fw-bold">üìú Historie akc√≠ ({{ akce|length }})</span>
    </div>
    <div class="collapse" id="collapseHistorie">
        <div class="card-body p-0">
            {% if akce %}
            <div class="table-mobile-wrap" style="max-height: 400px; overflow-y: auto;">
                <table class="table table-sm table-hover table-striped mb-0">
                    <thead class="table-dark sticky-top"><tr><th>Datum</th><th>Typ</th><th>Poboƒçka</th><th>U≈æivatel</th><th>Akce</th></tr></thead>
                    <tbody>
                    {% for akce_item in akce %}
                    <tr>
                        <td><small>{{ akce_item.datum.strftime('%d.%m.%Y %H:%M') }}</small></td>
                        <td>{% if akce_item.typ == 'Reklamace' %}<span class="badge bg-secondary">R</span>{% else %}<span class="badge bg-secondary">O</span>{% endif %}</td>
                        <td><small>{{ akce_item.pobocka }}</small></td>
                        <td><small><strong>{{ akce_item.uzivatel }}</strong></small></td>
                        <td><small>{{ akce_item.akce }}</small></td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="text-muted text-center py-3 mb-0">Zat√≠m nen√≠ ≈æ√°dn√° historie.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<!-- Pro ne-adminy: filtr roku + p≈ôehledy (bez spr√°vy u≈æivatel≈Ø) -->
{% if not is_admin %}
<div class="card card-apple mb-3">
    <div class="card-header py-2 d-flex justify-content-between align-items-center" style="background: var(--table-header-bg); color: var(--table-header-text);">
        <span class="fw-bold">Rok</span>
        <form method="GET"><select name="rok" class="form-select form-select-sm d-inline-block" style="width: auto;" onchange="this.form.submit()">
            {% set current_year = 2026 %}
            {% for rok in range(current_year, current_year - 6, -1) %}
            <option value="{{ rok }}" {% if rok == selected_year %}selected{% endif %}>{{ rok }}</option>
            {% endfor %}
        </select></form>
    </div>
</div>
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);"><span class="fw-bold">P≈ôehled poboƒçek ‚Äì Odbƒõry</span></div>
    <div class="card-body p-0">
        {% if prehled %}
        <div class="table-mobile-wrap">
            <table class="table table-hover table-striped mb-0 small">
                <thead class="table-success"><tr><th>Poboƒçka</th><th class="text-center">Aktivn√≠</th><th class="text-center">Zelen√©</th><th class="text-center">ƒåerven√©</th><th class="text-center">Vyd√°no</th><th class="text-end">ƒå√°stka (Kƒç)</th></tr></thead>
                <tbody>{% for polozka in prehled %}
                <tr>
                    <td><strong>{{ polozka.nazev }}</strong></td>
                    <td class="text-center"><span class="badge bg-primary rounded-pill">{{ polozka.aktivni }}</span></td>
                    <td class="text-center"><span class="badge bg-success rounded-pill">{{ polozka.zelene }}</span></td>
                    <td class="text-center"><span class="badge bg-danger rounded-pill">{{ polozka.cervene }}</span></td>
                    <td class="text-center"><span class="badge bg-info text-dark rounded-pill">{{ polozka.vydano }}</span></td>
                    <td class="text-end"><strong>{{ "{:,.0f}".format(polozka.castka_vydano) }} Kƒç</strong></td>
                </tr>{% endfor %}</tbody>
            </table>
        </div>
        {% else %}<p class="text-muted text-center py-3 mb-0">Zat√≠m ≈æ√°dn√© poboƒçky.</p>{% endif %}
    </div>
</div>
<div class="card card-apple mb-3">
    <div class="card-header py-2" style="background: var(--table-header-bg); color: var(--table-header-text);"><span class="fw-bold">Reklamace podle poboƒçek</span></div>
    <div class="card-body p-0">
        {% if reklamace_prehled %}
        <div class="table-mobile-wrap">
            <table class="table table-hover table-striped mb-0 small">
                <thead class="table-warning"><tr><th>Poboƒçka</th><th class="text-center">Celkem</th><th class="text-center">Vy≈ô√≠zen√©</th><th class="text-center">Akce</th></tr></thead>
                <tbody>{% for r in reklamace_prehled %}
                <tr>
                    <td><strong>{{ r.nazev }}</strong></td>
                    <td class="text-center"><span class="badge bg-secondary rounded-pill">{{ r.celkem }}</span></td>
                    <td class="text-center"><span class="badge bg-success rounded-pill">{{ r.vyrizene }}</span></td>
                    <td class="text-center"><a href="{{ url_for('reklamace_branch', pobocka_id=r.pobocka_id) }}" class="btn btn-sm btn-outline-primary">Otev≈ô√≠t</a></td>
                </tr>{% endfor %}</tbody>
            </table>
        </div>
        {% else %}<p class="text-muted text-center py-3 mb-0">Zat√≠m ≈æ√°dn√© reklamace.</p>{% endif %}
    </div>
</div>
{% endif %}
{% endblock %}
